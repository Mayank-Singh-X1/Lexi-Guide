<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Shared Document Analysis - LexiGuard</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; max-width: 900px; margin: 40px auto; padding: 20px; line-height: 1.6; background-color: #f9f9f9; color: #333;}
        h1, h2, h3 { color: #4a4a4a; }
        .container { background-color: #fff; border: 1px solid #ddd; padding: 25px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 20px; }
        pre { white-space: pre-wrap; word-wrap: break-word; background-color: #f4f4f4; padding: 15px; border-radius: 5px; border: 1px solid #eee; }
        .risk-analysis { border-left: 4px solid #d9534f; }
        .summary-analysis { border-left: 4px solid #5cb85c; }
    </style>
</head>
<body>
    <div class="container">
        <h1>LexiGuard Analysis</h1>
        <h3 id="filename">Loading...</h3>
        <p id="doc-type"></p>
        <hr>
        <div class="analysis-section"><h3>âœ… Summary & Action Plan</h3><pre id="summary-text" class="summary-analysis"></pre></div>
        <div class="analysis-section"><h3>ðŸš¨ Risk Radar</h3><pre id="risk-text" class="risk-analysis"></pre></div>
    </div>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        // --- PASTE YOUR FIREBASE CONFIG HERE TOO ---
        const firebaseConfig = { /* ... your config ... */ };
        
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        async function loadSharedAnalysis() {
            const params = new URLSearchParams(window.location.search);
            const shareId = params.get('id');

            if (!shareId) {
                document.getElementById('filename').textContent = "Error: No Share ID provided.";
                return;
            }

            try {
                const docRef = doc(db, 'shared_analyses', shareId);
                const docSnap = await getDoc(docRef);

                if (docSnap.exists()) {
                    const data = docSnap.data();
                    document.getElementById('filename').textContent = data.filename || "Shared Analysis";
                    document.getElementById('doc-type').textContent = `Document Type: ${data.doc_type}`;
                    document.getElementById('summary-text').textContent = data.summary_and_checklist;
                    document.getElementById('risk-text').textContent = data.risk_analysis;
                } else {
                    document.getElementById('filename').textContent = "Error: This shared analysis could not be found or has been deleted.";
                }
            } catch (error) {
                console.error("Error loading shared analysis:", error);
                document.getElementById('filename').textContent = "An error occurred while loading the analysis.";
            }
        }

        loadSharedAnalysis();
    </script>
</body>
</html>
